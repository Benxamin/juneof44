<!doctype HTML>
<html>
<head>
	<title>Cropper</title>
	<script type="text/javascript" src="eventListener.polyfill.js"></script>
	<!-- <script type="text/javascript" src="draggabilly.min.js"></script> -->
	<script type="text/javascript" src="drag-resize.js"></script>
</head>
<body>
<style type="text/css">

	/* Page */
	body {
		background-color: #666;
		font-family: "Helvetica Neue", Helvetica, Arial, sans;
		margin: 0;
	}
	h1, h2, h3, h4, h5, h6, p, ul {
		margin-top: 0;
	}
	header {
		background: #f1f1f1;
		border-bottom: 2px solid #333;
	}
	header h1 {
		margin-bottom: 0;
	}
	article {

	}
	footer {
		background: #333;
		border-top: 2px solid #333;
		border-bottom: 2px solid #333;
		color: #ccc;
		text-align: center;
	}
	.inner {
		border-left: 2px solid #333;
		border-right: 2px solid #333;
		background: #e1e1e1;
		padding: 2em;
		margin: 0 auto;
		max-width: 950px;
		min-width: 350px;
	}

	/* Image Control */
	.image {
		background: url(http://placekitten.com/800/500) center center no-repeat #666; 
		background-size: cover; 
		height: 300px; 
		width: 300px; 
		position: relative;
	}
	.img-control {
		background: #999;
		border: none;
		color: #fff;
		cursor: pointer;
		display: block;
		height: 48px;
		width: 48px;
		font-size: 35px;
		line-height: 42px;
		text-align: center;
		overflow: hidden;
		opacity: 0.8;
		position: absolute;
	}
	.img-control:hover,
	.img-control:active {
		opacity: 1.0;
	}
	.img-delete {
		top: 0;
		right: 0;
	}
	.img-rotate {
		bottom: 8px;
		left: 8px;
	}
	.img-crop {
		bottom: 8px;
		left: 68px;
	}
	/* Modal */
	.modal {
		background: rgba(21, 21, 21, 0.85);
		display: none;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		position: absolute;
		text-align: center;
		height: 101%;
		width: 101%;
		z-index: 100;
	}
	.modal-inner {
		display: table-cell;
		position: relative;
		vertical-align: middle;
	}
	/* Crop Tool */
	.crop-border {
		border: 1px solid #000;
		background: #666;
		margin: 0 auto;
		position: relative;
		height: 550px;
		width: 800px;
	}
	.crop-btns {
		background: #000;
		color: #fff;
		height: 50px;
		font-weight: bold;
		font-size: 1em;
		position: absolute;
		bottom: -50px;
		left: 0;
		width: 100%;
	}
	.crop-container {
		height: 500px;
		width: 800px;
		position: relative;
	}
	.crop-btns button {
		background: none;
		border: none;
		font-family: "Helvetica Neue", Helvetica, Arial, sans;
		font-size: 0.75em;
		font-weight: bold;
	}
	button.cancel {
		color: #fff;
		display: inline;
		float: left;
		margin: 1em;
	}
	button.crop {
		background: #e1e1e1;
		border-radius: 3px;
		height: 32px;
		float: right;
		margin: 0.5em 1em;
		padding: 0 1em;
	}
	.original {
		position: absolute;
		top: 0;
		left: 0;
	}
	.crop-overlay,
	.crop-handle {
		border: 1px solid #fff;
		position: absolute;
	}
	.crop-overlay {
		cursor: move;
		height: 300px;
		width: 300px;
	}
	.crop-handle {
		background: #fff;
		bottom: -6px;
		font-size: 1px;
		height: 11px;
		opacity: 0.75
		position: absolute;
		width: 11px;
	}
	.crop-handle-nw {
		cursor: nw-resize;
		left: -11px;
		top: -11px;
	}
	.crop-handle-n {
		cursor: n-resize;
		left: 50%;
		margin-left: -5px;
		top: -11px;
	}
	.crop-handle-ne {
		cursor: ne-resize;
		right: -11px;
		top: -11px;
	}
	.crop-handle-se {
		cursor: sw-resize;
		bottom: -11px;
		left: -11px;
	}
	.crop-handle-s {
		cursor: s-resize;
		bottom: -11px;
		left: 50%;
		margin-left: -5px;
	}
	.crop-handle-sw {
		cursor: se-resize;
		bottom: -11px;
		right: -11px;
	}
	.crop-handle-e {
		cursor: e-resize;
		margin-top: -5px;
		right: -11px;
		top: 50%;
	}
	.crop-handle-w {
	 cursor: w-resize;
	 left: -11px;
	 margin-top: -5px;
	 top: 50%;
	}
</style>


	<header aria-role="header">
		<div class="inner">
			<h1>Cropper</h1>
		</div>
	</header>
	<article aria-role="main">
		<div class="inner">
			<h4>Cropper</h4>
			<div class="image">
				<button class="img-control img-delete" title="Delete this image">&times;</button>
				<button class="img-control img-rotate" title="Rotate this image 90º clockwise">↱</button>
				<button class="img-control img-crop" title="Crop this image">&#164;</button>
			</div>
		</div>	
		<div class="inner">
			<div class="crop-container">
				<h2>DragResize 1.0</h2>

				<div class="drsElement" style="left: 50px; top: 150px; width: 250px; height: 120px; background: #CDF; text-align: center">
					<div class="drsMoveHandle">Div 0</div>
	 				<p>Some content</p>
				</div>

				<div class="drsElement" style="left: 20px; top: 300px; width: 150px; height: 200px; background: #FDC; text-align: center">
	 				<div class="drsMoveHandle">Div 1</div>
	 				<p>Some content</p>
				</div>

				<div class="drsElement drsMoveHandle" style="left: 150px; top: 280px; width: 50px; height: 100px; background: #DFC; text-align: center">
				 Div 2 Content
				</div>

			</div>
		</div>
	</article>
	<footer aria-role="footer">
		<div class="inner">
			<h6>&copy; 2014 The Berts Master</h6>
		</div>
	</footer>
	<div class="modal" id="cropModal">
		<div class="modal-inner">
			<div class="crop-border">
				<div class="crop-container" id="crop-container">
					<img class="original" id="original" src="http://placekitten.com/800/500" title="Cropping...">
					<div class="crop-btns">
						<button class="cancel">Cancel</button>
						<button class="crop">Done Cropping</button>
					</div>
					<div class="crop-overlay" id="crop-zone" draggable="true"></div>
				</div>
			</div>
		</div>
		<script src="drag-resize.init.js" type="text/javascript"></script>
	</div>

	<script type="text/javascript">
		var submodal =  document.getElementById("cropModal");
		if (!submodal) {
			throw new Error("No element 'submodal'");
		}
		var cropObject = {};

		var setAction = function(className, eventName, callback) {
			var ctls = document.getElementsByClassName(className);
			if (ctls && ctls.length > 0) {
				var i = 0;
				for(i; i < ctls.length; i += 1) {
					if (ctls[i].addEventListener) {
					  ctls[i].addEventListener(eventName, callback, false);
					} else if (ctls[i].attachEvent) {
					  el.attachEvent('on'+ eventName, callback);
					}
				}
			}
		}

		var escapeModal = function(e) {
			e = e || window.event;
			var keycode = (typeof(e.which) == "number") ? e.which : e.keyCode;
			if (keycode === 27) {
				hideModal(submodal);
			}
		};

		var showModal = function() {
			submodal.setAttribute("style", "display:table;");
			submodal.className += ' show';
			
			document.addEventListener("keydown", escapeModal, false);
		};

		var hideModal = function() {
			if (submodal.className.indexOf("show") > -1) {
				submodal.setAttribute("style", "dispaly:none;");
				submodal.className = submodal.className.replace(/\bshow\b/,'');
				document.removeEventListener("keydown", escapeModal, false);
			}
		};

		var resizeCropFrame = function(event) {
			console.dir(event);
		};

		var doCrop = function() {
			console.log("Done!");
			// TODO: GET request to API
			// TODO: API
			// sendCrop();
			hideModal();
			console.dir(cropObject);
		};

		setAction("img-crop", "click", showModal);
		setAction("cancel", "click", hideModal);
		setAction("crop", "click", doCrop);
	</script>
</body>
</html>